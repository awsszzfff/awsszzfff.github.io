---
date: 2001-01-01
tags:
  - Others
categories:
  - Others
title: "BUUCTF_zip伪加密"
---
# BUUCTF_zip伪加密



下载题目是一个 zip 压缩包，解压需要密码，但是对于密码并没有任何提示，且题目明确提示为 zip 伪加密，说明应该是不用密码滴。

**zip 文件组成：数据存储区 + 中心目录区 + 目录结束标志 。**

从图中可以看出，三个颜色明确的将文件三部分组成表示出来，其开头都是固定的标志，其中有一个全局标志位（可表示是否加密，奇数为加密，偶数未加密）。

![image-20220909110945603](img/image-20220909110945603.png)

对标志位进行修改：

![image-20220909110343603](img/image-20220909110343603.png)

保存后再次打开即可得 flag 。

![image-20220909110216576](img/image-20220909110216576.png)

### 补充：

#### 文件实体头（File Entry Header）

| 偏移 | 字节数 | 类型 | 描述                                                         |
| ---- | ------ | ---- | ------------------------------------------------------------ |
| 0    | 4      |      | 固定值 0x04034b50                                            |
| 4    | 2      |      | 解压缩版本                                                   |
| 6    | 2      |      | 标志【全局方式位标记（有无加密，**奇数加密，偶数无加密**）】 |
| 8    | 2      |      | 压缩方式                                                     |
| 10   | 2      |      | 文件最后修改时间                                             |
| 12   | 2      |      | 文件最后修改日期                                             |
| 14   | 4      |      | CRC-32校验                                                   |
| 18   | 4      |      | 压缩后大小                                                   |
| 22   | 4      |      | 压缩前大小                                                   |
| 26   | 2      |      | 文件名长度(n)                                                |
| 28   | 2      |      | 扩展字段长度(m)                                              |
| 30   | n      |      | 文件名称                                                     |
| 30+n | m      |      | 扩展字段                                                     |

#### 文件实体数据描述符（Data descriptor）

| 偏移 | 字节数 | 类型 | 描述             |
| ---- | ------ | ---- | ---------------- |
| 0    | 0/4    |      | 固定值0x08074b50 |
| 0/4  | 4      |      | CRC-32校验       |
| 4/8  | 4      |      | 压缩后大小       |
| 8/12 | 4      |      | 压缩前大小       |

#### 目录源数据文件头（File Header）

通常以`50 4B 01 02`标识开头。对应的编码如下：

| 偏移   | 字节数 | 类型 | 描述                                                         |
| ------ | ------ | ---- | ------------------------------------------------------------ |
| 0      | 4      |      | 固定值0x02014b50                                             |
| 4      | 2      |      | 压缩版本                                                     |
| 6      | 2      |      | 解压缩版本                                                   |
| 8      | 2      |      | 标志【全局方式位标记（有无加密，**奇数加密，偶数无加密**）】 |
| 10     | 2      |      | 压缩方式                                                     |
| 12     | 2      |      | 文件最后修改时间                                             |
| 14     | 2      |      | 文件最后修改日期                                             |
| 16     | 4      |      | CRC-32校验                                                   |
| 20     | 4      |      | 压缩后大小                                                   |
| 24     | 4      |      | 压缩前大小                                                   |
| 28     | 2      |      | 文件名称长度(n)                                              |
| 30     | 2      |      | 扩展字段长度(m)                                              |
| 32     | 2      |      | 文件注释长度(k)                                              |
| 34     | 2      |      | 文件开始的分卷号                                             |
| 36     | 2      |      | 文件内部属性                                                 |
| 38     | 4      |      | 文件外部属性                                                 |
| 42     | 4      |      | 对应文件实体在文件中的偏移                                   |
| 46     | n      |      | 文件名称                                                     |
| 46+n   | m      |      | 扩展字段                                                     |
| 46+n+m | k      |      | 文件注释                                                     |

#### 目录结束标识

| 偏移 | 字节数 | 类型 | 描述                                |
| ---- | ------ | ---- | ----------------------------------- |
| 0    | 4      |      | 固定值为0x06054b50                  |
| 4    | 2      |      | 当前分卷号                          |
| 6    | 2      |      | Central Directory的开始分卷号       |
| 8    | 2      |      | 当前分卷Central Directory的记录数量 |
| 10   | 2      |      | Central Directory的总记录数量       |
| 12   | 4      |      | Central Directory的大小(bytes)      |
| 16   | 4      |      | Central Directory的开始位置偏移     |
| 20   | 2      |      | Zip文件注释长度(n)                  |
| 22   | n      |      | Zip文件注释                         |
