---
title: "20240320AutoDAN-HGC"
date: 2024-11-21
tags:
  - Others
categories:
  - Others
---
# 20240320AutoDAN-HGC

# Based Information

| 类型  | 篇名                                                                               | 关键字        | 作者           | 年份         | 页码  |
| --- | -------------------------------------------------------------------------------- | ---------- | ------------ | ---------- | --- |
|     | AUTODAN: GENERATING STEALTHY JAILBREAK  PROMPTS ON ALIGNED LARGE LANGUAGE MODELS | JailBreak; | Xiaogeng Liu | 2024/03/20 | 21  |

# Important Information

## Contributions

利用遗传算法，自动化的生成隐蔽越狱提示，这些提示在语义上是有意义的，不容易被检测到。

特别为结构化离散数据设计的层次化遗传算法，通过在句子和单词级别上应用不同的交叉策略，避免陷入局部最优解，在有限迭代中找到全局最优解。

![[attachments/Pasted image 20241125151405.png]]

## Method

- 种群初始化
使用 LLM 对原型越狱提示进行多样化处理，以保持基本特征的同时引入多样性。

- 适应度评估
取越狱攻击目标的似然，来评估遗传算法中的个体适应度。
$$\mathcal{L}_{J_i}=-log(P(r_{m+1},r_{m+2},\ldots,r_{m+k}|t_1,t_2,\ldots,t_m))\tag{3}$$

- 遗传策略（核心在于设计交叉和变异函数）
AutoDAN-GA和AutoDAN-HGA


AutoDAN-HGA 利用文本数据的层次结构，先在句子级别上进行优化，然后在段落级别上进行优化。【分层遗传算法】

1. 段落级别
	1. 选择：基于适应度分数，使用 softmax 函数计算每个提示被选择的概率；确保适应度较高的提示有更大概率参与交叉和变异；
$$P_{J_i}=\frac{e^{S_{J_i}}}{\sum_{j=1}^{N-N*\alpha}e^{S_{J_j}}}\tag{4}$$
	2. 交叉：对选中的父代提示进行多点交叉操作，在多个断点处交换两个提示句子，以产生新的后代提示；
	3. 变异：交叉后进行变异，算法 5；
2. 句子级别
	1. 动量词字典构建：过滤掉一些常见单词和专有名词，为每个单词分配一个基于其在多个提示中出现的适应度分数的平均值。根据分数对单词排序，选择分数最高的 K 个单词；算法 8；
	2. 替换词与同义词：在动量词词典中查找同义词，基于这些同义词分数来替换；算法 9；

【目的都是为了增加语义上的多样性】

![[attachments/Pasted image 20241125151300.png]]

【AutoDAN-GA 会陷入局部最优，而AutoDAN-HGA 会持续优化，寻找全局最优】

![[attachments/Pasted image 20241125153220.png]]

- 终止条件
在 LLM 响应中的前 K 个单词中未检出到集合列表中的关键字，或达到最大迭代次数则跳出循环。

## Shortcome

计算开销较大；在 Llama2 中表现不佳

# PS (2024/11/21)

> 算法2：AutoDAN-HGA

**输入**：原越狱提示、关键词列表（评估 LLM 响应是否包含拒绝信号）、超参数；
**步骤：**
1. **初始化种群：**
   使用基于LLM的多样化算法（算法5）初始化种群。这个步骤确保了初始种群的多样性，同时保留了原型越狱提示的基本特征。
2. **主循环：**
   只要模型的响应中包含拒绝信号，并且迭代次数未达到上限，就继续执行循环。
3. **句子级别迭代：**
   对于每个句子级别的迭代：
   - 评估种群中每个个体的适应度分数，使用公式（3）计算。
   - 计算动量词分数，使用算法8构建动量词字典。
   - 更新每个提示中的句子，使用算法9替换单词与其同义词。
4. **段落级别迭代：**
   对于每个段落级别的迭代：
   - 再次评估种群中每个个体的适应度分数。
   - 选择精英和父代提示，基于它们的适应度分数，使用公式（4）。
   - 对父代提示执行交叉和变异操作，使用算法7。
5. **返回最优越狱提示：**
   当循环结束时，返回具有最高适应度分数的越狱提示 `Jmax`。
**关键点解释：**
- **适应度评估：** 使用公式（3）计算每个越狱提示的适应度分数，即 `-log(P(rm+1, rm+2, ..., rm+k|t1, t2, ..., tm))`，其中 `P` 是给定输入下，LLMs输出特定目标响应的概率。这个分数越高，表示越狱提示越有效。
- **动量词评分：** 算法8通过考虑单词在多个提示中的适应度分数的平均值来为每个单词分配一个重要性分数。这个分数反映了单词对于成功越狱攻击的贡献。
- **单词替换：** 算法9基于动量词字典中的分数，决定是否用同义词替换原文中的单词，以增加提示的多样性和隐蔽性。
- **精英选择：** 精英率 `α` 确保了表现最好的个体可以直接进入下一代，这有助于保持种群中的最佳解。
- **交叉和变异：** 算法7结合了交叉和变异操作，以产生新的后代。交叉通过交换父代提示中的句子来产生新的组合，而变异则通过LLM-based diversification引入小的变化。


> 遗传算法：
1. 初始化种群：生成初始的种群，作为算法的起点。
	- 随机生成一定数量的个体，每个个体表示问题的一个可能解。
    - 个体的表示形式可以是二进制串、实数向量、排列等，具体取决于问题的性质。
2. 评估适应度：计算每个个体的适应度值，评估其在解决特定问题上的优劣程度。
    - 定义适应度函数，将个体的编码映射为一个数值。
    - 计算每个个体的适应度值。
3. 选择：根据适应度值选择个体，生成新一代种群。
    - 选择方法有多种，常见的包括轮盘赌选择、锦标赛选择、精英选择等。
    - 轮盘赌选择：根据适应度值的比例，随机选择个体。
    - 锦标赛选择：随机选择若干个体进行比较，选择适应度值最高的个体。
    - 精英选择：保留适应度值最高的若干个体，直接进入下一代。
4. 交叉：通过交换两个个体的部分基因，生成新的个体，增加种群的多样性。
    - 随机选择一对个体进行交叉。
    - 选择一个或多个交叉点，交换两个个体在交叉点之间的基因。
    - 生成新的个体，加入新一代种群。
5. 变异：通过随机改变个体的某些基因，引入新的多样性，避免早熟收敛。
    - 以一定的概率（变异概率）随机选择个体进行变异。
    - 随机改变个体的某些基因，生成新的个体。
    - 生成的个体加入新一代种群。
6. 终止条件：决定何时停止算法。
    - 达到预定的迭代次数。
    - 适应度值收敛，即种群中个体的适应度值变化很小。
    - 找到满足问题要求的最优解。

